<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>LKMC.Basin &mdash; LKMC 150623-237-g6ff714a documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '150623-237-g6ff714a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="LKMC 150623-237-g6ff714a documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LKMC 150623-237-g6ff714a documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for LKMC.Basin</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provide superbasin method to solve low-barrier flicker problems.</span>

<span class="sd">Copyright Miao Yu 2014</span>

<span class="sd">References</span>
<span class="sd">----------</span>

<span class="sd">* L.K. Beland, P. Brommer, F. El-Mellouhi, J.-F. Joly and N. Mousseau. </span>
<span class="sd">  Kinetic activation-relaxation techinique.</span>
<span class="sd">  Phy. Rev. E 84, 046704 (2011) doi: 10.1103/PhysRevE.84.046704</span>
<span class="sd">* B. Puchala, M.L. Falk and K. Garikipati. </span>
<span class="sd">  An energy basin finding algorithm for kinetic Monte Carlo acceleration.</span>
<span class="sd">  J. Chem. Phys. 132, 134104 (2010) doi: 10.1063/1.3369627</span>
<span class="sd">* K.A. Fichthorn and Y. Lin. </span>
<span class="sd">  A local superbasin kinetic Monte Carlo method.</span>
<span class="sd">  J. Chem. Phys. 138, 164104 (2013) doi: 10.1063/1.4801869</span>

<span class="sd">Note: The script is coded base on Beland&#39;s work.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Utilities</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Globals</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Refine</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Lattice</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Graphs</span>
<span class="kn">from</span> <span class="nn">.Utilities</span> <span class="k">import</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">Dummy</span>

<div class="viewcode-block" id="TransitionObject"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.TransitionObject">[docs]</a><span class="k">class</span> <span class="nc">TransitionObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `TransitionObject` class holds information about a transition event, </span>
<span class="sd">    which is associated with a basin state.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    barrier : float</span>
<span class="sd">        The (forward) barrier of the transition.</span>
<span class="sd">    reverseBarrier : float</span>
<span class="sd">        The backward (reverse) barrier of the transition.</span>
<span class="sd">    rate : float</span>
<span class="sd">        The original (uncorrected) rate of the transition.</span>
<span class="sd">    finalHashkey : string</span>
<span class="sd">        The (primary) hashkey of the final state of the transition.</span>
<span class="sd">    finalCOM : ndarray</span>
<span class="sd">        The (primary) Center Of Mass of the final state of the transition.</span>
<span class="sd">    finalAtomPos : integer</span>
<span class="sd">        The index of transitions in the Volume file. </span>
<span class="sd">        i.e. where does this transition save in the Volume file.</span>
<span class="sd">    flag : integer</span>
<span class="sd">        * If 0 : ordinary event;</span>
<span class="sd">        * If 1 : potential basin event;</span>
<span class="sd">        * If 2 : basin event.</span>
<span class="sd">    finalDV : integer</span>
<span class="sd">        The index of basin state where the final state of the transition pointed. </span>
<span class="sd">        i.e. the connection between basin states.</span>
<span class="sd">    final : `Lattice.Lattice` object</span>
<span class="sd">        The object holds information of the final state of the transition.</span>
<span class="sd">    index : integer</span>
<span class="sd">        The finalVolIndex in the list of defectVolumes of the final state of the transition. </span>
<span class="sd">        This might different from the currentVolIndex.</span>
<span class="sd">    savePos : bool, optional</span>
<span class="sd">        * If True : (default, only if `final` object is given) Store information about the defect volume atoms. </span>
<span class="sd">    moment : ndarray, optional</span>
<span class="sd">        The (primary) Moment of the final state of the transition.</span>
<span class="sd">    currentVolIndex : integer, optional</span>
<span class="sd">        The currentVolIndex in the list of defectVolumes of the initial state of the transtion. </span>
<span class="sd">        i.e. the index of current working volume. </span>
<span class="sd">        </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    NDefects : integer</span>
<span class="sd">        Number of atoms in the given defect volume.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span> <span class="n">finalAtomPos</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> 
                 <span class="n">finalDV</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">savePos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barrier</span> <span class="o">=</span> <span class="n">barrier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reverseBarrier</span> <span class="o">=</span> <span class="n">reverseBarrier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">finalHashkey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalCOM</span> <span class="o">=</span> <span class="n">finalCOM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalAtomPos</span> <span class="o">=</span> <span class="n">finalAtomPos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="n">finalDV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finalVolIndex</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentVolIndex</span> <span class="o">=</span> <span class="n">currentVolIndex</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">NDefects</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="ow">and</span> <span class="n">savePos</span> <span class="ow">and</span> <span class="n">final</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storeFinalDVInfo</span><span class="p">(</span><span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    
<div class="viewcode-block" id="TransitionObject.dupInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.TransitionObject.dupInfo">[docs]</a>    <span class="k">def</span> <span class="nf">dupInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dupHashkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupCOM</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupMoment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save information about the final state of the transition, if the final states </span>
<span class="sd">        have different hashkeys due to small variation.</span>
<span class="sd">        </span>
<span class="sd">        Sometimes the same final state of a transition may have different hashkeys </span>
<span class="sd">        due to small variation. Store information about the final states, which will be </span>
<span class="sd">        used to get the correct connectivities within a superbasin.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dupHashkey : string, optional</span>
<span class="sd">            The (secondary) hashkey of the final state of the transition.</span>
<span class="sd">        dupCOM : ndarray, optional</span>
<span class="sd">            The (secondary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        dupMoment : ndarray, optional</span>
<span class="sd">            The (secondary) Moment of the final state of the transition.</span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
        <span class="k">if</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupHashkey</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupCOM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupMoment</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING, not given all duplicate information, ignore...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TransitionObject.storeFinalDVInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.TransitionObject.storeFinalDVInfo">[docs]</a>    <span class="k">def</span> <span class="nf">storeFinalDVInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store information about the defect volume atoms of the transition.</span>
<span class="sd">        These information will be used to compare whether two states with different hashkeys</span>
<span class="sd">        are actually the same or not.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about final state of the transition.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The finalVolIndex in the list of defectVolumes of the final state of the transition. </span>
<span class="sd">        </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        primaryVol : ndarray</span>
<span class="sd">            Indexes of primary atoms (searchMoveVol) in the defect volume. </span>
<span class="sd">        graphVol : ndarray</span>
<span class="sd">            Indexes of graph atoms (used to calculate hashkey) in the defect volume.</span>
<span class="sd">        dvPos : ndarray</span>
<span class="sd">            Possitions of primary atoms.</span>
<span class="sd">        NDefects : integer</span>
<span class="sd">            Number of atoms in the given defect volume.</span>
<span class="sd">        vacancies : ndarray</span>
<span class="sd">            Indexes of atoms (in the reference system) which are vacancies in the given defect volume.</span>
<span class="sd">        interstitials : ndarray</span>
<span class="sd">            Indexes of atoms (in the given lattice) which are interstitials in the given defect volume.</span>
<span class="sd">        antisites : ndarray</span>
<span class="sd">            Indexes of atoms (in the reference system) which are antisites in the given defect volume.</span>
<span class="sd">        onAntisites : ndarray</span>
<span class="sd">            Indexes of atoms (in the given lattice) which are onAntisites in the given defect volume.</span>
<span class="sd">        defectPos : ndarray</span>
<span class="sd">            Possitions of all defect atoms, in the order of vacancies, interstitials, onAntisites.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># store index of atoms in current defect volume</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">searchMoveVol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">NDefects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacancies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interstitials</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div></div>
        
<div class="viewcode-block" id="DefectVolumeObject"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject">[docs]</a><span class="k">class</span> <span class="nc">DefectVolumeObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `DefectVolumeObject` class holds information about a basin state.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : `Lattice.Lattice` object</span>
<span class="sd">        The object holds information about the system.</span>
<span class="sd">    index : integer</span>
<span class="sd">        The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">    BasinObject : `BasinObject` object</span>
<span class="sd">        The object holds information about a superbasin, where the current basin state is belonged.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    hashkey : string</span>
<span class="sd">        The (primary) hashkey of the basin state.</span>
<span class="sd">    COM : ndarray</span>
<span class="sd">        The (primary) Center Of Mass of the basin state.</span>
<span class="sd">    moment : ndarray, optional</span>
<span class="sd">        The (primary) Moment of the basin state.</span>
<span class="sd">    dupHashkey : string, optional</span>
<span class="sd">        The (secondary) hashkey of the basin state.</span>
<span class="sd">    dupCOM : ndarray, optional</span>
<span class="sd">        The (secondary) Center Of Mass of the basin state.</span>
<span class="sd">    dupMoment : ndarray, optional</span>
<span class="sd">        The (secondary) Moment of the basin state.</span>
<span class="sd">    primaryVol : ndarray</span>
<span class="sd">        Indexes of primary atoms (searchMoveVol) in the defect volume of the basin state. </span>
<span class="sd">    graphVol : ndarray</span>
<span class="sd">        Indexes of graph atoms (used to calculate hashkey) in the defect volume of the basin state.</span>
<span class="sd">    dvPos : ndarray</span>
<span class="sd">        Possitions of primary atoms of the basin state.</span>
<span class="sd">    NDefects : integer</span>
<span class="sd">        Number of atoms in the given defect volume.</span>
<span class="sd">    vacancies : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are vacancies in the given defect volume of the basin state.</span>
<span class="sd">    interstitials : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are interstitials in the given defect volume of the basin state.</span>
<span class="sd">    antisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are antisites in the given defect volume of the basin state.</span>
<span class="sd">    onAntisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are onAntisites in the given defect volume of the basin state.</span>
<span class="sd">    defectPos : ndarray</span>
<span class="sd">        Possitions of all defect atoms, in the order of vacancies, interstitials, onAntisites.</span>
<span class="sd">    transitions : list</span>
<span class="sd">        List of `TransitionObject` objects. Holds information of transitions associated with this basin state.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">BasinObject</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hashkey</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">COM</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">com</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># store index of atoms in current defect volume</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">searchMoveVol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">NDefects</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vacancies</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">interstitials</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">antisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span> <span class="o">=</span> <span class="n">BasinObject</span>
        
<div class="viewcode-block" id="DefectVolumeObject.dupInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject.dupInfo">[docs]</a>    <span class="k">def</span> <span class="nf">dupInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dupHashkey</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupCOM</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dupMoment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save information about the basin state, if the basin states </span>
<span class="sd">        have different hashkeys due to small variation.</span>
<span class="sd">        </span>
<span class="sd">        Sometimes the same basin state may have different hashkeys </span>
<span class="sd">        due to small variation. Store information about the basin states, which will be </span>
<span class="sd">        used to get the correct connectivities within a superbasin.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dupHashkey : string, optional</span>
<span class="sd">            The (secondary) hashkey of the final state of the transition.</span>
<span class="sd">        dupCOM : ndarray, optional</span>
<span class="sd">            The (secondary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        dupMoment : ndarray, optional</span>
<span class="sd">            The (secondary) Moment of the final state of the transition.</span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
        <span class="k">if</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupHashkey</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupCOM</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dupMoment</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">dupHashkey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupCOM</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">dupMoment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING, not given all duplicate information, ignore...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="DefectVolumeObject.createTrans"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject.createTrans">[docs]</a>    <span class="k">def</span> <span class="nf">createTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span> 
                    <span class="n">finalAtomPos</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savePos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a transition associated with current basin state. </span>
<span class="sd">            * If already stored, pass;</span>
<span class="sd">            * If not stored, create a `TransitionObject` object and store it.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        barrier : float</span>
<span class="sd">            The (forward) barrier of the transition.</span>
<span class="sd">        reverseBarrier : float</span>
<span class="sd">            The backward (reverse) barrier of the transition.</span>
<span class="sd">        rate : float</span>
<span class="sd">            The original (uncorrected) rate of the transition.</span>
<span class="sd">        finalHashkey : string</span>
<span class="sd">            The (primary) hashkey of the final state of the transition.</span>
<span class="sd">        finalCOM : ndarray</span>
<span class="sd">            The (primary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        finalAtomPos : integer</span>
<span class="sd">            The index of transitions in the Volume file. </span>
<span class="sd">            i.e. where does this transition save in the Volume file.</span>
<span class="sd">        flag : integer</span>
<span class="sd">            * If 0 : ordinary event;</span>
<span class="sd">            * If 1 : potential basin event;</span>
<span class="sd">            * If 2 : basin event.</span>
<span class="sd">        finalDV : integer</span>
<span class="sd">            The index of basin state where the final state of the transition pointed. </span>
<span class="sd">            i.e. the connection between basin states.</span>
<span class="sd">        final : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information of the final state of the transition.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The finalVolIndex in the list of defectVolumes of the final state of the transition. </span>
<span class="sd">            This might different from the currentVolIndex.</span>
<span class="sd">        savePos : bool, optional</span>
<span class="sd">            * If True : (default, only if `final` object is given) Store information about the defect volume atoms. </span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>
<span class="sd">        currentVolIndex : integer, optional</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the initial state of the transtion. </span>
<span class="sd">            i.e. the index of current working volume. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : integer</span>
<span class="sd">            * If 0 : successfully create and store the transition;</span>
<span class="sd">            * If 1 : cannot store the transition due to already stored.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first check if the transition already stored</span>
        <span class="n">alreadyStored</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">trans</span><span class="o">.</span><span class="n">finalAtomPos</span> <span class="o">==</span> <span class="n">finalAtomPos</span><span class="p">:</span>
                <span class="n">alreadyStored</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">alreadyStored</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">TransitionObject</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span> 
                                     <span class="n">finalAtomPos</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">savePos</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="n">moment</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="n">currentVolIndex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Warning, cannot create transition on basin state, alreadyStored=</span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">alreadyStored</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span></div>
    
<div class="viewcode-block" id="DefectVolumeObject.whichTrans"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.DefectVolumeObject.whichTrans">[docs]</a>    <span class="k">def</span> <span class="nf">whichTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ignoreFlag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find all transitions which have the same final state as given. </span>
<span class="sd">        Used for build connectivities of a superbasin.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the system.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">        ignoreFlag : bool, optional</span>
<span class="sd">            * If False: only check transitions with flag 1 or 2 (Basin event/Potential basin event);</span>
<span class="sd">            * If True: check all transitions.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        transNum : list</span>
<span class="sd">            Indexes of transitions stored in `self.transitions`.</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chosenHashkey</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>
        <span class="n">chosenCOM</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">com</span>
        <span class="n">chosenMoment</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
        <span class="n">transNum</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># store defects in current dv</span>
        <span class="n">NDefects</span><span class="p">,</span> <span class="n">vacancies</span><span class="p">,</span> <span class="n">interstitials</span><span class="p">,</span> <span class="n">antisites</span><span class="p">,</span> <span class="n">onAntisites</span><span class="p">,</span> <span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
            <span class="n">transIJK</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">flag</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">ignoreFlag</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">chosenHashkey</span> <span class="o">==</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">chosenCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span><span class="p">,</span> <span class="n">chosenCOM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span> 
                            <span class="k">if</span> <span class="n">chosenMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="n">chosenMoment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                    <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># check duplicate info</span>
                    <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">chosenHashkey</span> <span class="o">==</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">kk</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">chosenCOM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">chosenCOM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span> 
                                    <span class="k">if</span> <span class="n">chosenMoment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">kk</span><span class="p">],</span> <span class="n">chosenMoment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                            <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                                            <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">1</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                                        <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                                <span class="n">dupflag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">dupflag</span><span class="p">:</span>
                        <span class="k">continue</span>
                
                    <span class="c1"># check defects and sep of dv</span>
                    <span class="k">elif</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">NDefects</span> <span class="o">==</span> <span class="n">NDefects</span> <span class="ow">and</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">vacancies</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">interstitials</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">antisites</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">antisites</span><span class="p">):</span>
                            
                            <span class="c1"># no need to compare positions of vacancies and antisites (these are reference positions), only check interstitials.</span>
                            <span class="n">pos1</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                            <span class="n">pos2</span> <span class="o">=</span> <span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                            <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                            
                            <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinSepTol</span><span class="p">:</span>
                            
                                <span class="n">graphList</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">graphVol</span><span class="p">,</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span>
                                <span class="n">pos1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                                <span class="n">pos2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                                
                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">)):</span>
                                    <span class="n">jj</span> <span class="o">=</span> <span class="n">graphList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="p">]</span>
                                        <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                                        
                                        <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))]</span>
                                        <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                                    <span class="k">except</span><span class="p">:</span>
                                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention(trans): Atom </span><span class="si">%d</span><span class="s2"> not in list&quot;</span><span class="o">%</span><span class="n">jj</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                
                                <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Sep check </span><span class="si">%lf</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sep</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">BasinObject</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinSepTol</span><span class="p">:</span>
                                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention: basin states with diff hashkeys(Trans)&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                    
                                    <span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chosenHashkey</span><span class="p">)</span>
                                    <span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chosenCOM</span><span class="p">)</span>
                                    <span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chosenMoment</span><span class="p">)</span>
                                    <span class="n">transNum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">transNum</span></div></div>
        
<div class="viewcode-block" id="BasinObject"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject">[docs]</a><span class="k">class</span> <span class="nc">BasinObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The `BasinObject` class holds information about a superbasin.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    KMCRunner : `KMC.KMCRunner` object</span>
<span class="sd">        We need some information/methods from this object.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    defectVolumes : list</span>
<span class="sd">        List of `DefectVolumeObject` objects, holds information about all basin states in this superbasin.</span>
<span class="sd">    connectivity : list (2D matrix)</span>
<span class="sd">        Hold information about the connectivity within this superbasin.</span>
<span class="sd">    params : `Input.InputParams` object</span>
<span class="sd">        This object contains all parameters which are read from ``lkmcInput.IN`` by default.</span>
<span class="sd">    cellDims : ndarray</span>
<span class="sd">        Cell dimensions of the system. Used for PBC.</span>
<span class="sd">    pointer : list of integer</span>
<span class="sd">        Store the start/end point for each basin state. </span>
<span class="sd">        e.g. For a superbasin with three basin states, which, respectively, have 3,4,5 transitions. </span>
<span class="sd">        The pointer will be [0,3,7,12].</span>
<span class="sd">    currentDV : integer</span>
<span class="sd">        The index of basin state where the system currently is.</span>
<span class="sd">    currentTrans : integer</span>
<span class="sd">        The index of transition which has been chosen in the last step.</span>
<span class="sd">    previousDV : integer</span>
<span class="sd">        The index of basin state where the system is on previous step. </span>
<span class="sd">        This is a backup for previous `currentDV`. `currentDV` will fall back to this value </span>
<span class="sd">        if we failed to perform chosen transitions in the superbasin in current step.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">KMCRunner</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span> <span class="o">=</span> <span class="n">KMCRunner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">currentState</span><span class="o">.</span><span class="n">cellDims</span>
        <span class="c1">#pointer, store start point for each DV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1">#current defect volume&#39;s index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">#the index of transition that has been chosen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="BasinObject.createDV"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.createDV">[docs]</a>    <span class="k">def</span> <span class="nf">createDV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and store a new basin states into the superbasin. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the system.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">            </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DefectVolumeObject</span><span class="p">(</span><span class="n">lattice</span><span class="o">=</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">BasinObject</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span></div>
        
<div class="viewcode-block" id="BasinObject.whichDV"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.whichDV">[docs]</a>    <span class="k">def</span> <span class="nf">whichDV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">createFlag</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the basin state which have the same defect volume as given. </span>
<span class="sd">        Used for build connectivities of a superbasin.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        lattice : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the system.</span>
<span class="sd">        index : integer</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the system.</span>
<span class="sd">        createFlag : bool, optional</span>
<span class="sd">            * If True: If the given state is not found in stored basin states, create one for it.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DVNum : integer</span>
<span class="sd">            Index of basin state stored in `self.defectVolumes`.</span>
<span class="sd">        dupFlag : bool</span>
<span class="sd">            * If True: The basin state found have different hashkey form the given one, </span>
<span class="sd">              but they are identical defect volumes.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>    
        
        <span class="n">hashkey</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span>
        <span class="n">COM</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">com</span>
        <span class="n">moment</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
        
        <span class="c1"># if the given DV is a duplicate basin state, return dupFlag</span>
        <span class="n">dupFlag</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># store defects in current dv</span>
        <span class="n">NDefects</span><span class="p">,</span> <span class="n">vacancies</span><span class="p">,</span> <span class="n">interstitials</span><span class="p">,</span> <span class="n">antisites</span><span class="p">,</span> <span class="n">onAntisites</span><span class="p">,</span> <span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="n">DVi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">DVi</span><span class="o">.</span><span class="n">hashkey</span> <span class="o">==</span> <span class="n">hashkey</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">moment</span><span class="p">,</span> <span class="n">moment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># check duplicate info</span>
                <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">==</span> <span class="n">hashkey</span><span class="p">:</span>
                        <span class="n">dupFlag</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">if</span> <span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">COM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinCOMTol</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">moment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">diff</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">moment</span><span class="p">,</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinMomentTol</span><span class="p">:</span>
                                        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span>
                
                <span class="c1"># check defects and sep of DV</span>
                <span class="k">if</span> <span class="n">DVi</span><span class="o">.</span><span class="n">NDefects</span> <span class="o">==</span> <span class="n">NDefects</span> <span class="ow">and</span> <span class="n">DVi</span><span class="o">.</span><span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">NDefects</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">vacancies</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">interstitials</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">set</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">antisites</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">antisites</span><span class="p">):</span>
                        <span class="c1"># no need to compare positions of vacancies and antisites (these are reference positions), only check interstitials.</span>
                        <span class="n">pos1</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                        <span class="n">pos2</span> <span class="o">=</span> <span class="n">defectPos</span><span class="p">[(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)):(</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">vacancies</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">interstitials</span><span class="p">)))]</span>
                        <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                        
                        <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinSepTol</span><span class="p">:</span>
                        
                            <span class="n">graphList</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">graphVol</span><span class="p">,</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span><span class="p">)</span>
                            <span class="n">pos1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                            <span class="n">pos2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                            
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graphList</span><span class="p">)):</span>
                                <span class="n">jj</span> <span class="o">=</span> <span class="n">graphList</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="p">]</span>
                                    <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="n">pos1</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">pos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">jj</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                                    
                                    <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))]</span>
                                    <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="n">pos2</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">dvPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">jj</span><span class="p">))</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                                <span class="k">except</span><span class="p">:</span>
                                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention(DV): atom </span><span class="si">%d</span><span class="s2"> not in list&quot;</span><span class="o">%</span><span class="n">jj</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                            
                            <span class="n">sep</span> <span class="o">=</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cellDims</span><span class="p">)</span>
                            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Sep check </span><span class="si">%lf</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sep</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">sep</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">basinSepTol</span><span class="p">:</span>
                                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Attention: basin states with diff hashkeys(DV) </span><span class="si">%r</span><span class="s2">-</span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hashkey</span><span class="p">,</span> <span class="n">DVi</span><span class="o">.</span><span class="n">hashkey</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                                <span class="n">dupFlag</span> <span class="o">=</span> <span class="kc">True</span>
                                
                                <span class="n">DVi</span><span class="o">.</span><span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashkey</span><span class="p">)</span>
                                <span class="n">DVi</span><span class="o">.</span><span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">COM</span><span class="p">)</span>
                                <span class="n">DVi</span><span class="o">.</span><span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">moment</span><span class="p">)</span>
                                <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">dupFlag</span>
        <span class="k">if</span> <span class="n">createFlag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createDV</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dupFlag</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dupFlag</span></div>
    
<div class="viewcode-block" id="BasinObject.createTrans"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.createTrans">[docs]</a>    <span class="k">def</span> <span class="nf">createTrans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">DVNum</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span> 
                    <span class="n">finalAtomPos</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">final</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">savePos</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a transition associated with the given basin state. </span>
<span class="sd">            * If already stored, pass;</span>
<span class="sd">            * If not stored, create a `TransitionObject` object and store it.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        DVNum : integer</span>
<span class="sd">            The index of basin state in the superbasin to be associated with the transition.</span>
<span class="sd">        barrier : float</span>
<span class="sd">            The (forward) barrier of the transition.</span>
<span class="sd">        reverseBarrier : float</span>
<span class="sd">            The backward (reverse) barrier of the transition.</span>
<span class="sd">        rate : float</span>
<span class="sd">            The original (uncorrected) rate of the transition.</span>
<span class="sd">        finalHashkey : string</span>
<span class="sd">            The (primary) hashkey of the final state of the transition.</span>
<span class="sd">        finalCOM : ndarray</span>
<span class="sd">            The (primary) Center Of Mass of the final state of the transition.</span>
<span class="sd">        finalAtomPos : integer</span>
<span class="sd">            The index of transitions in the Volume file. </span>
<span class="sd">            i.e. where does this transition save in the Volume file.</span>
<span class="sd">        flag : integer</span>
<span class="sd">            * If 0 : ordinary event;</span>
<span class="sd">            * If 1 : potential basin event;</span>
<span class="sd">            * If 2 : basin event.</span>
<span class="sd">        finalDV : integer, optional</span>
<span class="sd">            The index of basin state where the final state of the transition pointed. </span>
<span class="sd">            i.e. the connection between basin states.</span>
<span class="sd">        final : `Lattice.Lattice` object, optional</span>
<span class="sd">            The object holds information of the final state of the transition.</span>
<span class="sd">        index : integer, optional</span>
<span class="sd">            The finalVolIndex in the list of defectVolumes of the final state of the transition. </span>
<span class="sd">            This might different from the currentVolIndex.</span>
<span class="sd">        savePos : bool, optional</span>
<span class="sd">            * If True : (default, only if `final` object is given) Store information about the defect volume atoms. </span>
<span class="sd">        moment : ndarray, optional</span>
<span class="sd">            The (primary) Moment of the final state of the transition.</span>
<span class="sd">        currentVolIndex : integer, optional</span>
<span class="sd">            The currentVolIndex in the list of defectVolumes of the initial state of the transtion. </span>
<span class="sd">            i.e. the index of current working volume. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : integer</span>
<span class="sd">            * If 0 : successfully create and store the transition;</span>
<span class="sd">            * If 1 : cannot store the transition due to already stored.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">DVNum</span><span class="p">]</span><span class="o">.</span><span class="n">createTrans</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span> 
                                                     <span class="n">finalAtomPos</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="p">,</span> <span class="n">final</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">savePos</span><span class="p">,</span> <span class="n">moment</span><span class="o">=</span><span class="n">moment</span><span class="p">,</span> <span class="n">currentVolIndex</span><span class="o">=</span><span class="n">currentVolIndex</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="BasinObject.buildConnectivity"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.buildConnectivity">[docs]</a>    <span class="k">def</span> <span class="nf">buildConnectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the connectivity within the superbasin. Used for find pathways while perform transition in the superbasin.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">DVNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span>
        
        <span class="c1"># double check connectivity stored</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="n">DVNum</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">==</span> <span class="n">DVNum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="c1">#resize the matrix, last column and line would be np.nan</span>
            <span class="k">for</span> <span class="n">tmpi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">tmpi</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">([[]</span> <span class="k">for</span> <span class="n">tmpi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)])</span>
            
            <span class="n">DVi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">))</span>
            
            <span class="c1">#loop over transitions of new added DV</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="n">Transij</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="c1">#for B event, check if finalDV exist</span>
                <span class="k">if</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">&gt;=</span> <span class="n">DVNum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="c1">#                     self.connectivity[-1][Transij.finalDV] = j</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                
                <span class="c1">#for P event, check if it&#39;s B event</span>
                <span class="k">if</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">Transij</span><span class="p">)</span>
                    <span class="n">index</span><span class="p">,</span> <span class="n">dupFlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whichDV</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
                        <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="n">index</span>
<span class="c1">#                         self.connectivity[-1][index] = j</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                        
            <span class="c1">#find the reverse path</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">])</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">DVi</span><span class="p">)</span>
                        <span class="n">transNumList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">whichTrans</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">transNumList</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">transNumList</span><span class="p">:</span>
                                <span class="n">Transik</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                <span class="n">Transik</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
                                <span class="n">Transik</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="n">DVNum</span><span class="o">-</span><span class="mi">1</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">index</span><span class="p">]):</span>
                            <span class="k">pass</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;WARNING: Rebuild entire connectivity! Possible not build connectivity after add new defect volumes.&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[[[]</span> <span class="k">for</span> <span class="n">tmpi</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">tmpj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
                <span class="n">DVi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                    <span class="n">Transij</span> <span class="o">=</span> <span class="n">DVi</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="c1">#Search for all B event, check if finalDV exist</span>
                    <span class="k">if</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">&gt;=</span> <span class="n">DVNum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">elif</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    
                    <span class="c1">#Search for all P event, check if it&#39;s a B event or not. Check whether finals of P event are in the basin or not.</span>
                    <span class="k">if</span> <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">lattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">Transij</span><span class="p">)</span>
                        <span class="n">index</span><span class="p">,</span> <span class="n">dupFlag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">whichDV</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">Transij</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">2</span>
                            <span class="n">Transij</span><span class="o">.</span><span class="n">finalDV</span> <span class="o">=</span> <span class="n">index</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        
        
        <span class="c1"># double check connectivity stored</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="n">volumeI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeI</span><span class="o">.</span><span class="n">transitions</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeI</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="n">transIJ</span> <span class="o">=</span> <span class="n">volumeI</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">transIJ</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transIJ</span><span class="o">.</span><span class="n">finalDV</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        
        <span class="c1">#check if the connectivity matrix is symmetric</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">i</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: Connectivity not symmetric! [</span><span class="si">%d</span><span class="s2">][</span><span class="si">%d</span><span class="s2">] has </span><span class="si">%d</span><span class="s2"> Trans and reverse has </span><span class="si">%d</span><span class="s2">!&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])),</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: Connectivity not symmetric! [</span><span class="si">%d</span><span class="s2">][</span><span class="si">%d</span><span class="s2">] has </span><span class="si">%d</span><span class="s2"> Trans and reverse has </span><span class="si">%d</span><span class="s2">!&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])),</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="BasinObject.shortestPath"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.shortestPath">[docs]</a>    <span class="k">def</span> <span class="nf">shortestPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the shortest pathway from the starting basin state to the ending basin state by using the Dijkstra&#39;s algorithm. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : integer</span>
<span class="sd">            Index of the starting basin state in `self.defectVolumes`.</span>
<span class="sd">        end : integer</span>
<span class="sd">            Index of the ending basin state in `self.defectVolumes`.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        S : list</span>
<span class="sd">            The pathway from start to end.</span>
<span class="sd">            *Notes* : </span>
<span class="sd">                * If return empty list : there&#39;s no path from start to end;</span>
<span class="sd">                * If the start == end : return a list with a single point;</span>
<span class="sd">                * If start == -1 : start = last DV.</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buildConnectivity</span><span class="p">()</span>
        <span class="c1">#initializations</span>
        <span class="n">DVNo</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span>
        <span class="c1">#all nodes in the graph</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNo</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#Check start and end within basin:</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Q</span> <span class="ow">or</span> <span class="n">end</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;ERROR: start(</span><span class="si">%d</span><span class="s2">) or end(</span><span class="si">%d</span><span class="s2">) are out of range (0..</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">DVNo</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1">#Special case! start=end</span>
        <span class="k">elif</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span>
        
        <span class="c1">#unknown distance from start</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">*</span> <span class="n">DVNo</span>
        <span class="c1">#previous node in optimal path from start</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">DVNo</span>
        <span class="c1">#distance from start to start</span>
        <span class="n">dist</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1">#main loop</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dist2</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
                <span class="n">dist2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1">#source node in first case</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="n">dist2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="nb">min</span><span class="p">(</span><span class="n">dist2</span><span class="p">))]</span>
            <span class="k">del</span> <span class="n">Q</span><span class="p">[</span><span class="n">Q</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">u</span><span class="p">)]</span>
            
            <span class="c1">#have found shortest path between start and end</span>
            <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                <span class="k">break</span>
            
            <span class="c1">#all remaining vertices are inaccessible from source</span>
            <span class="k">if</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                <span class="k">break</span>
            
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">Q</span><span class="p">:</span>
                 <span class="c1">#check if u,v is connected</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">v</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="n">alt</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">alt</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]:</span>
                        <span class="n">dist</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">alt</span>
                        <span class="n">previous</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span>
                        
        <span class="c1">#list of shortest path from start to end</span>
        <span class="n">S</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">end</span>
        <span class="c1">#construct the shortest path with a stack S</span>
        <span class="k">while</span> <span class="n">previous</span><span class="p">[</span><span class="n">w</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">w</span><span class="p">)</span>
            <span class="c1">#traverse from end to start</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">previous</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
        <span class="c1">#insert start only if there is a path</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">S</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">S</span></div>
    
<div class="viewcode-block" id="BasinObject.performTransition"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.performTransition">[docs]</a>    <span class="k">def</span> <span class="nf">performTransition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform transitions between basin states within the superbasin.</span>
<span class="sd">        i.e. perform series of refinements within the superbasin such that the current working basin state </span>
<span class="sd">        is transformed from ``start`` to ``end``.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        start : integer</span>
<span class="sd">            Index of the starting basin state in `self.defectVolumes`.</span>
<span class="sd">        end : integer</span>
<span class="sd">            Index of the ending basin state in `self.defectVolumes`.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status : integer</span>
<span class="sd">            * If 0 : success</span>
<span class="sd">            * else : error</span>
<span class="sd">        currentState : `Lattice.Lattice` object</span>
<span class="sd">            The object holds information about the lattice at the ``end`` basin state.</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        <span class="n">status</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">currentState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">currentState</span>
        <span class="n">refState</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">refState</span>
        <span class="n">defectVolumes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">defectVolumes</span>
        
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shortestPath</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
        
        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Perform transitions within the basin, pathway: </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">path</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1">#no path</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;ERROR: There is no path from current defect volume#(</span><span class="si">%d</span><span class="s2">) to DV#(</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;ERROR: There is no path from current defect volume#(</span><span class="si">%d</span><span class="s2">) to DV#(</span><span class="si">%d</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Target defect volume is current DV&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">currentState</span>
        <span class="c1">#transition</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">localStart</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">localEnd</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">transNo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">localStart</span><span class="p">][</span><span class="n">localEnd</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">transNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">transNo</span><span class="p">]</span><span class="o">.</span><span class="n">finalAtomPos</span>
                
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">transitions</span> <span class="o">=</span> <span class="n">defectVolumes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;ERROR: Volume transitions </span><span class="si">%s</span><span class="s2"> not found in stored DVs.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,),</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
                
                <span class="n">transIniPos</span> <span class="o">=</span> <span class="n">transitions</span><span class="o">.</span><span class="n">initialPos</span>
                <span class="n">transSpecie</span> <span class="o">=</span> <span class="n">transitions</span><span class="o">.</span><span class="n">specie</span>
                <span class="n">transList</span> <span class="o">=</span> <span class="n">transitions</span><span class="o">.</span><span class="n">transitionList</span>
                
                <span class="n">workingVol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">transNo</span><span class="p">]</span><span class="o">.</span><span class="n">currentVolIndex</span>
<span class="c1">#               # check validness of vorkingVol.</span>
                <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">workingVol</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">):</span>
                        <span class="n">workingVol</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">elif</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">:</span>
                        <span class="n">workingVol</span> <span class="o">=</span> <span class="kc">None</span>
                    
                <span class="c1"># try to find the right workingVol</span>
                <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tmpList</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">tmpList2</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">graphKey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">:</span>
                            <span class="n">tmpList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span>
<span class="c1">#                         elif currentState.defectVolumes[ii].graphKey in self.defectVolumes[localStart].dupHashkey:</span>
<span class="c1">#                             tmpList2.append(ii)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">workingVol</span> <span class="o">=</span> <span class="n">tmpList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#                         elif len(tmpList) == 0 and len(tmpList2) == 1:</span>
<span class="c1">#                             workingVol = tmpList2[0]</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">tmpListSep</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">tmpList</span><span class="p">:</span>
                                <span class="n">tmpListSep</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">separation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">.</span><span class="n">com</span><span class="p">,</span> <span class="n">currentState</span><span class="o">.</span><span class="n">cellDims</span><span class="p">))</span>
<span class="c1">#                             for jj in range(len(tmpList2)):</span>
<span class="c1">#                                 tmpListSep.append( Vectors.separation(self.defectVolumes[localStart].dupCOM, currentState.defectVolumes[jj].com, currentState.cellDims))</span>
                            <span class="n">tmpIndex</span> <span class="o">=</span> <span class="n">tmpListSep</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tmpListSep</span><span class="p">))</span>
                            <span class="k">if</span> <span class="n">tmpIndex</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmpList</span><span class="p">):</span>
                                <span class="n">workingVol</span> <span class="o">=</span> <span class="n">tmpList</span><span class="p">[</span><span class="n">tmpIndex</span><span class="p">]</span>
<span class="c1">#                             else:</span>
<span class="c1">#                                 tmpIndex -= len(tmpList)</span>
<span class="c1">#                                 workingVol = tmpList2(tmpIndex)</span>
<span class="c1">#                                 # refinement not working for dupHashkey</span>
<span class="c1">#                                 workingVol = None</span>
                
                <span class="nb">print</span> <span class="s2">&quot;Debug: workingVol </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">workingVol</span>
                <span class="k">if</span> <span class="n">workingVol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
                    
                <span class="n">graphVolume</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
                <span class="n">currentState</span><span class="o">.</span><span class="n">currentDefectVolume</span> <span class="o">=</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">workingVol</span><span class="p">]</span>
                    
                <span class="n">transitionRefiner</span> <span class="o">=</span> <span class="n">Refine</span><span class="o">.</span><span class="n">TransitionRefiner</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">refState</span><span class="p">)</span>
                <span class="n">transitionRefiner</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">currentState</span><span class="p">)</span>
                    
                <span class="n">trans</span> <span class="o">=</span> <span class="n">transList</span><span class="p">[</span><span class="n">transNum</span><span class="p">]</span>
                
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Refinement for volume </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2">) number </span><span class="si">%d</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">localStart</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">,</span> <span class="n">workingVol</span><span class="p">,</span> <span class="n">transNum</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
                <span class="n">newInputState</span><span class="p">,</span> <span class="n">resultInfo</span> <span class="o">=</span> <span class="n">transitionRefiner</span><span class="o">.</span><span class="n">refineFinalState</span><span class="p">(</span><span class="n">transIniPos</span><span class="p">,</span> <span class="n">transSpecie</span><span class="p">,</span> <span class="n">graphVolume</span><span class="p">,</span> <span class="n">volumeTransitionObject</span><span class="o">=</span><span class="n">trans</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">newInputState</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;ERROR: Refinement failed.&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">currentState</span> <span class="o">=</span> <span class="n">newInputState</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">hashkey</span> <span class="ow">in</span> <span class="n">currentState</span><span class="o">.</span><span class="n">defectVolumesKeys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="n">end</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="n">currentState</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;ERROR: Volume (</span><span class="si">%s</span><span class="s2">) not in final DV list.&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">hashkey</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="kc">None</span></div>
                    
         
<div class="viewcode-block" id="BasinObject.meanRate"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.meanRate">[docs]</a>    <span class="k">def</span> <span class="nf">meanRate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startDV</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correct the rates for all transitions stored in the superbasin by using the Mean Rate Method.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        startDV : integer, optional</span>
<span class="sd">            Index of basin state where the system entered the superbasin. Default: 0.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : list</span>
<span class="sd">            List of corrected rates for all transitions stored in the superbasin.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#build connectivity to update flags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buildConnectivity</span><span class="p">()</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stateNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)</span>
        <span class="n">transMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">stateNum</span><span class="p">,</span> <span class="n">stateNum</span><span class="p">])</span>
        
        
        <span class="c1">#mean residence time in state i each time it is visited</span>
        <span class="n">tao1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">transNum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="n">transNum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">)</span>
            <span class="nb">sum</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                <span class="nb">sum</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>
            <span class="k">if</span> <span class="nb">sum</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Error: Sum of rates for State </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> trans) is zero!&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">transNum</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">tao1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nb">sum</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUGINFO: tao1 are&quot;</span><span class="p">,</span> <span class="n">tao1</span>
        <span class="c1">#if there is only one DV in the basin, return origin rates</span>
        <span class="k">if</span> <span class="n">stateNum</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">transMatrix</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tao1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUGINFO: TransMatrix is&quot;</span><span class="p">,</span> <span class="n">transMatrix</span>
        <span class="n">occupVect0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">)</span>
        <span class="n">occupVect0</span><span class="p">[</span><span class="n">startDV</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            
        <span class="n">matrix2bInv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="n">stateNum</span><span class="p">))</span> <span class="o">-</span> <span class="n">transMatrix</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">occupVect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">matrix2bInv</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="s2">&quot;Error: Transition Matrix not invertible.&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUGINFO: Inverted Matrix is &quot;</span><span class="p">,</span> <span class="n">occupVect</span>
        <span class="n">occupVect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">occupVect</span><span class="p">,</span> <span class="n">occupVect0</span><span class="p">)</span>
        <span class="n">occupVect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">occupVect</span><span class="p">))</span>
            
        <span class="c1"># mean residence time in basin state i before leaving the basin</span>
        <span class="n">tao</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">stateNum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">taoSum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="n">tao</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tao1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">occupVect</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">taoSum</span> <span class="o">+=</span> <span class="n">tao</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="c1"># corrected rates</span>
        <span class="n">negRate</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">localRate</span> <span class="o">=</span> <span class="n">tao</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">taoSum</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">localRate</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">localRate</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;WARNING: get a negative mean rate!! </span><span class="si">%r</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">localRate</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">negRate</span> <span class="o">=</span> <span class="kc">True</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUG: origin rates:&quot;</span><span class="p">,</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stateNum</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">transNum</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                    <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span><span class="s2">&quot;)&quot;</span><span class="p">,</span>
            <span class="nb">print</span>
            <span class="nb">print</span> <span class="s2">&quot;DEBUG: mean rates:&quot;</span><span class="p">,</span><span class="n">result</span>
            
        <span class="k">if</span> <span class="n">negRate</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="BasinObject.write"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">,</span> <span class="n">basinNo</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the built superbasin into a file. Used for resuming an unfinished work.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            The name of the file to be written.</span>
<span class="sd">        outdir : string</span>
<span class="sd">            The location of the file to be written.</span>
<span class="sd">        basinNo : integer</span>
<span class="sd">            Index of the superbasin to be written.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        
        <span class="c1"># total line number for each basin: 6 + 16*DVNo + 23*TransNo</span>
        
        <span class="c1"># start sign</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&gt;!Basin</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">basinNo</span>
                
        <span class="c1">#1: pointer(length = volumeNum+1, last number = transNum)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
        <span class="c1">#2: connectivity</span>
        <span class="k">for</span> <span class="n">n1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">n1</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">n3</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="n">n2</span><span class="p">])):</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">,&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="n">n2</span><span class="p">][</span><span class="n">n3</span><span class="p">]</span>
                <span class="n">text</span> <span class="o">+=</span><span class="s2">&quot;;&quot;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
        <span class="c1">#3-4 line: currentDV, previousDV</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span><span class="p">)</span>
            
        <span class="c1">#loop for all DVs</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="n">volumeIJ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            
            <span class="c1"># start sign</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&gt;!DefectVol</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">j</span>
            
            <span class="c1">#1: hashkey</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">volumeIJ</span><span class="o">.</span><span class="n">hashkey</span>
                
            <span class="c1">#2: COM</span>
            <span class="k">if</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">COM</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">COM</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1">#3-4 primaryVol, graphVol</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">graphVol</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                
            <span class="c1">#5 dvPos</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dvPos</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1">#6-9 vacancies, interstitials, antisites, onAntisites</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">vacancies</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">interstitials</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">antisites</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1">#10 defectPos</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">defectPos</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1">#11-14 moment, dupHashkey, dupCOM, dupMoment</span>
            <span class="k">if</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">moment</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None &quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="c1">#loop for all trans</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">volumeIJ</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="n">transIJK</span> <span class="o">=</span> <span class="n">volumeIJ</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                
                <span class="c1">#start sign</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&gt;!TransObj</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">k</span>
                
                <span class="c1">#1-4: barrier, reverseBarrier, rate, finalHashkey</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%lf</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">barrier</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">rate</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalHashkey</span><span class="p">)</span>
                    
                <span class="c1">#5: finalCOM</span>
                <span class="k">if</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalCOM</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    
                <span class="c1">#6-9: finalAtomPos, flag, finalDV, currentVolIndex</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%r</span><span class="se">\n</span><span class="si">%d</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">transIJK</span><span class="o">.</span><span class="n">finalAtomPos</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalDV</span><span class="p">,</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">finalVolIndex</span><span class="p">)</span>
                
                <span class="c1">#10-17 primaryVol, graphVol, dvPos, vacancies, interstitials, antisites, onAntisites, defectPos</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">transIJK</span><span class="p">,</span> <span class="s2">&quot;primaryVol&quot;</span><span class="p">):</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">*</span><span class="mi">8</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1">#10-11 primaryVol, graphVol</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">primaryVol</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">graphVol</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                        
                    <span class="c1">#12 dvPos</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dvPos</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    
                    <span class="c1">#13-16 vacancies, interstitials, antisites, onAntisites</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">vacancies</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">interstitials</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">antisites</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                    
                    <span class="c1">#17 defectPos</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">defectPos</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                
                <span class="c1">#18-21 moment, dupHashkey, dupCOM, dupMoment</span>
                <span class="k">if</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">moment</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupHashkey</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None &quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">p</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupCOM</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">transIJK</span><span class="o">.</span><span class="n">dupMoment</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;None;&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
                            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%lf</span><span class="s2"> &quot;</span><span class="o">%</span><span class="n">q</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;;&quot;</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                
                <span class="c1">#end sign</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!TransObj</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">k</span>
            <span class="c1">#end sign</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!DefectVol</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">j</span>
        <span class="c1">#end sign</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s2">&quot;&lt;!Basin</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">basinNo</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">writer</span>
        <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outdir</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;append&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="BasinObject.read"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read information about the stored superbasin from a file. Create and store corresponding objects. </span>
<span class="sd">        Used form resuming an unfinished work.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        line : string</span>
<span class="sd">            Lines read from a file, which store informations about the superbasin.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>      
          
        <span class="c1">#1 pointer</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span> <span class="o">=</span> <span class="n">pointer</span>
        <span class="n">DVNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pointer</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        
        <span class="c1">#2 connectivity</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">connectivity</span> <span class="o">=</span> <span class="p">[[[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">)]</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">readline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">DVNum</span><span class="o">+</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">k</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span>
        
        <span class="c1">#3-4 currentDV</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#4 previousDV</span>
        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># create DVs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DVNum</span><span class="p">):</span>
            <span class="c1"># check start sign</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&gt;!DefectVol&quot;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error start sign (DV) while reading basin file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error DV number while reading basin file.&quot;</span><span class="p">)</span>
            
            <span class="n">dummyTrans</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyTrans</span><span class="p">()</span>
            
            <span class="c1">#1 hashkey</span>
            <span class="n">hashkey</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">hashkey</span>
            
            <span class="c1">#2 COM</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">COM</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">COM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalCOM</span> <span class="o">=</span> <span class="n">COM</span>

            <span class="c1">#3-4 primaryVol, graphVol</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">primaryVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">primaryVol</span>
            
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">graphVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">graphVol</span>
            
            <span class="c1">#5 dvPos</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">dvPos</span>
            
            <span class="c1">#6-9 vacancies, interstitials, antisites, onAntisites</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">vacancies</span> <span class="o">=</span> <span class="n">vacancies</span>
            
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">interstitials</span> <span class="o">=</span> <span class="n">interstitials</span>
            
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">antisites</span> <span class="o">=</span> <span class="n">antisites</span>
            
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">onAntisites</span> <span class="o">=</span> <span class="n">onAntisites</span>
            
            <span class="c1">#10 defectPos</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectPos</span>
            
            <span class="c1">#11-14 moment, dupHashkey, dupCOM, dupMoment</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">moment</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
            
            <span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="n">dupHashkey</span>
            
            <span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="n">dupCOM</span>
            
            <span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
            <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                    <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
            <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="n">dupMoment</span>
            
            <span class="n">dummyLattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">dummyTrans</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DefectVolumeObject</span><span class="p">(</span><span class="n">dummyLattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
            
            <span class="n">volume</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1">#create transitions</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pointer</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pointer</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="c1"># check start sign</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&gt;!TransObj&quot;</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error start sign (Trans) while reading basin file.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">10</span><span class="p">:])</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error Trans number while reading basin file.&quot;</span><span class="p">)</span>
                
                <span class="n">dummyTrans</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyTrans</span><span class="p">()</span>
                <span class="c1">#1 barrier</span>
                <span class="n">barrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                
                <span class="c1">#2 reverseBarrier</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">reverseBarrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">reverseBarrier</span> <span class="o">=</span> <span class="kc">None</span>
                    
                <span class="c1">#3 rate</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                
                <span class="c1">#4 finalHashkey</span>
                <span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">finalHashkey</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">):</span>
                    <span class="n">finalHashkey</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalHashkey</span> <span class="o">=</span> <span class="n">finalHashkey</span>
                
                <span class="c1">#5 finalCOM</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">finalCOM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">finalCOM</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">dummyTrans</span><span class="o">.</span><span class="n">finalCOM</span> <span class="o">=</span> <span class="n">finalCOM</span>
                
                <span class="c1">#6-7 finalAtomPos, flag</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">finalAtomPos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">finalAtomPos</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                
                <span class="c1">#8 finalDV</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">finalDV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">finalDV</span> <span class="o">=</span> <span class="kc">None</span>
                    
                <span class="c1">#9 currentVolIndex</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">currentVolIndex</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">currentVolIndex</span> <span class="o">=</span> <span class="kc">None</span>
                
                <span class="c1">#10-17 primaryVol, graphVol, dvPos, vacancies, interstitials, antisites, onAntisites, defectPos</span>
                <span class="n">savePos</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1"># dvPos info stored?</span>
                <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">savePos</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
                        <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># primaryVol</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">readline</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">primaryVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">primaryVol</span> <span class="o">=</span> <span class="n">primaryVol</span>
                    
                    <span class="c1">#graphVol</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">graphVol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">graphVol</span> <span class="o">=</span> <span class="n">graphVol</span>
                    
                    <span class="c1">#dvPos</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">dvPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">dvPos</span> <span class="o">=</span> <span class="n">dvPos</span>
                    
                    <span class="c1">#vacancies, interstitials, antisites, onAntisites</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">vacancies</span> <span class="o">=</span> <span class="n">vacancies</span>
                    
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">interstitials</span> <span class="o">=</span> <span class="n">interstitials</span>
                    
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">antisites</span> <span class="o">=</span> <span class="n">antisites</span>
                    
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">onAntisites</span> <span class="o">=</span> <span class="n">onAntisites</span>
                    
                    <span class="c1">#defectPos</span>
                    <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">readline</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                        <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                    <span class="n">dummyTrans</span><span class="o">.</span><span class="n">defectPos</span> <span class="o">=</span> <span class="n">defectPos</span>
                    
                <span class="k">if</span> <span class="n">savePos</span><span class="p">:</span>
                    <span class="n">dummyLattice</span> <span class="o">=</span> <span class="n">Dummy</span><span class="o">.</span><span class="n">DummyLatticeBasin</span><span class="p">(</span><span class="n">dummyTrans</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dummyLattice</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">createTrans</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">reverseBarrier</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">finalHashkey</span><span class="p">,</span> <span class="n">finalCOM</span><span class="p">,</span> <span class="n">finalAtomPos</span><span class="p">,</span> <span class="n">flag</span><span class="p">,</span> <span class="n">finalDV</span><span class="p">,</span> <span class="n">dummyLattice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">savePos</span><span class="p">)</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">finalVolIndex</span> <span class="o">=</span> <span class="n">currentVolIndex</span>
                
                <span class="c1">#18-21 moment, dupHashkey, dupCOM, dupMoment</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">readline</span><span class="p">)</span> <span class="o">&lt;&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">moment</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">moment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">readline</span><span class="p">))</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span> <span class="o">=</span> <span class="n">moment</span>
                
                <span class="n">dupHashkey</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                        <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">p</span> <span class="o">&lt;&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="n">dupHashkey</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span> <span class="o">=</span> <span class="n">dupHashkey</span>
                
                <span class="n">dupCOM</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                        <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                        <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dupCOM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dupCOM</span> <span class="o">=</span> <span class="n">dupCOM</span>
                
                <span class="n">dupMoment</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">readline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
                <span class="n">readline</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">readline</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
                        <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                        <span class="n">q</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">dupMoment</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">q</span><span class="p">)))</span>
                <span class="n">volume</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dupMoment</span> <span class="o">=</span> <span class="n">dupMoment</span>
                
                <span class="c1"># check end sign</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&lt;!TransObj&quot;</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end sign (Trans) while reading basin file.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">10</span><span class="p">:])</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end Trans number while reading basin file.&quot;</span><span class="p">)</span>
            <span class="c1"># check end sign</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&lt;!DefectVol&quot;</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end sign (DV) while reading basin file.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">11</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end DV number while reading basin file.&quot;</span><span class="p">)</span>
        <span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="BasinObject.printout"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.BasinObject.printout">[docs]</a>    <span class="k">def</span> <span class="nf">printout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Usually for debug use. Print out all information about the current superbasin.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">),</span> <span class="s2">&quot;defectVolumes&quot;</span>
        <span class="nb">print</span> <span class="s2">&quot;currentDV: </span><span class="si">%s</span><span class="s2">, currentTrans: </span><span class="si">%s</span><span class="s2">, previousDV: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentDV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentTrans</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">previousDV</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;    #&quot;</span><span class="p">,</span><span class="n">i</span>
            <span class="nb">print</span> <span class="s2">&quot;    hashkey:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hashkey</span>
            <span class="nb">print</span> <span class="s2">&quot;    center of mass:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">COM</span>
            <span class="nb">print</span> <span class="s2">&quot;    moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
            <span class="nb">print</span> <span class="s2">&quot;    &gt;dup hashkey:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span>
            <span class="nb">print</span> <span class="s2">&quot;    &gt;dup com:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dupCOM</span>
            <span class="nb">print</span> <span class="s2">&quot;    &gt;dup moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dupMoment</span>
            <span class="nb">print</span> <span class="s2">&quot;     DV atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">primaryVol</span>
            <span class="nb">print</span> <span class="s2">&quot;     graph atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
            <span class="nb">print</span> <span class="s2">&quot;     vacancies:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">vacancies</span>
            <span class="nb">print</span> <span class="s2">&quot;     interstitials:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">interstitials</span>
            <span class="nb">print</span> <span class="s2">&quot;     antisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">antisites</span>
            <span class="nb">print</span> <span class="s2">&quot;     onAntisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">onAntisites</span>
            
            <span class="nb">print</span> <span class="s2">&quot;    &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">),</span> <span class="s2">&quot;transitions&quot;</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">)):</span>
                <span class="nb">print</span> <span class="s2">&quot;        ##&quot;</span><span class="p">,</span> <span class="n">j</span>
                <span class="nb">print</span> <span class="s2">&quot;        barrier:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">barrier</span>
                <span class="nb">print</span> <span class="s2">&quot;        reverse barrier:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">reverseBarrier</span>
                <span class="nb">print</span> <span class="s2">&quot;        rate:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">rate</span>
                <span class="nb">print</span> <span class="s2">&quot;        final hashkey:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalHashkey</span>
                <span class="nb">print</span> <span class="s2">&quot;        final center of mass:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalCOM</span>
                <span class="nb">print</span> <span class="s2">&quot;        final moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">moment</span>
                <span class="nb">print</span> <span class="s2">&quot;        &gt;final dup hashkey:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dupHashkey</span>
                <span class="nb">print</span> <span class="s2">&quot;        &gt;final dup com:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dupCOM</span>
                <span class="nb">print</span> <span class="s2">&quot;        &gt;final dup moment:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">dupMoment</span>
                <span class="nb">print</span> <span class="s2">&quot;        final atom position:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalAtomPos</span>
                <span class="nb">print</span> <span class="s2">&quot;        flag:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span>
                <span class="nb">print</span> <span class="s2">&quot;        final DV:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalDV</span>
                <span class="nb">print</span> <span class="s2">&quot;        current volume index:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">currentVolIndex</span>
                <span class="nb">print</span> <span class="s2">&quot;        final volume index:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">finalVolIndex</span>
                
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="s2">&quot;primaryVol&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
                    <span class="nb">print</span> <span class="s2">&quot;         DV atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">primaryVol</span>
                    <span class="nb">print</span> <span class="s2">&quot;         graph atoms:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">graphVol</span>
                    <span class="nb">print</span> <span class="s2">&quot;         vacancies:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">vacancies</span>
                    <span class="nb">print</span> <span class="s2">&quot;         interstitials:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">interstitials</span>
                    <span class="nb">print</span> <span class="s2">&quot;         antisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">antisites</span>
                    <span class="nb">print</span> <span class="s2">&quot;         onAntisites:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">transitions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">onAntisites</span>
                
        <span class="nb">print</span> <span class="s2">&quot;connectivity:&quot;</span>
        <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
        <span class="nb">print</span> <span class="s2">&quot;pointer:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointer</span></div></div>

<div class="viewcode-block" id="defectInfo"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.defectInfo">[docs]</a><span class="k">def</span> <span class="nf">defectInfo</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the information about defect atoms in a given defect volume.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lattice : &#39;Lattice&#39; object</span>
<span class="sd">        The object holds information about the whole lattice</span>
<span class="sd">    index : integer</span>
<span class="sd">        The Volume Index in the list of defectVolumes of the lattice. </span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    NDefects : integer</span>
<span class="sd">        Number of atoms in the given defect volume.</span>
<span class="sd">    vacancies : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are vacancies in the given defect volume.</span>
<span class="sd">    interstitials : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are interstitials in the given defect volume.</span>
<span class="sd">    antisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the reference system) which are antisites in the given defect volume.</span>
<span class="sd">    onAntisites : ndarray</span>
<span class="sd">        Indexes of atoms (in the given lattice) which are onAntisites in the given defect volume.</span>
<span class="sd">    defectPos : ndarray</span>
<span class="sd">        Possitions of all defect atoms, in the order of vacancies, interstitials, onAntisites.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    
    <span class="c1"># store defects info in current dv</span>
    <span class="n">vacancies</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interstitials</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">antisites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">onAntisites</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">defectPos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NDefects</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">NDefects</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">cluster</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">cluster</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">NDefects</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span><span class="p">:</span>
                <span class="n">vacancies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacancies</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">vacPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                
            <span class="k">elif</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span> <span class="o">+</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NInt</span><span class="p">):</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span>
                <span class="n">interstitials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">interstitials</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">intPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ii</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NVac</span> <span class="o">-</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">NInt</span>
                <span class="n">antisites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">antisites</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">onAntisites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntisites</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">defectPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">defectsObject</span><span class="o">.</span><span class="n">onAntPos</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">ii</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">defectPos</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">NDefects</span><span class="p">)</span>
    <span class="n">vacancies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">vacancies</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">interstitials</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">interstitials</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">antisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">antisites</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">onAntisites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">onAntisites</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">NDefects</span><span class="p">,</span> <span class="n">vacancies</span><span class="p">,</span> <span class="n">interstitials</span><span class="p">,</span> <span class="n">antisites</span><span class="p">,</span> <span class="n">onAntisites</span><span class="p">,</span> <span class="n">defectPos</span></div>

<div class="viewcode-block" id="writeBasin"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.writeBasin">[docs]</a><span class="k">def</span> <span class="nf">writeBasin</span><span class="p">(</span><span class="n">KMCRunner</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the built superbasins into a file. Used for resuming an unfinished work.</span>
<span class="sd">        </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    KMCRunner : `KMC.KMCRunner` object</span>
<span class="sd">        We need some information/methods from this object.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
        <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">buildConnectivity</span><span class="p">()</span>
    
    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;basinList.bsn&quot;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">searchResults</span><span class="o">.</span><span class="n">taskOutputDir</span>
            
    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Writing basin file </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">outdir</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1">#first line: number of basin</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)</span>
    
    <span class="n">textObj</span> <span class="o">=</span> <span class="n">Utilities</span><span class="o">.</span><span class="n">TextObject</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">writerItem</span><span class="p">(</span><span class="s2">&quot;WRITE&quot;</span><span class="p">,</span> <span class="n">dataType</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">textObj</span><span class="p">,],</span> <span class="n">outdir</span><span class="o">=</span><span class="n">outdir</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;write&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">item</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">method</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">])</span>
    <span class="n">KMCRunner</span><span class="o">.</span><span class="n">writer</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    
    <span class="c1">#loop for all basins</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
        <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">outdir</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="readBasin"><a class="viewcode-back" href="../../LKMC/LKMC.Basin.html#LKMC.Basin.readBasin">[docs]</a><span class="k">def</span> <span class="nf">readBasin</span><span class="p">(</span><span class="n">KMCRunner</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read information about the stored superbasin from a file. Create and store corresponding objects. </span>
<span class="sd">    Used form resuming an unfinished work.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    KMCRunner : `KMC.KMCRunner` object</span>
<span class="sd">        We need some information/methods from this object.</span>
<span class="sd">    filename : string</span>
<span class="sd">        The name of the file to be read in.</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;Reading basin file </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        
    <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    
    <span class="n">basinNum</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basinNum</span><span class="p">):</span>
        <span class="c1"># check start sign and basinNo</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&gt;!Basin&quot;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error start sign while reading basin file.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error basin number while reading basin file.&quot;</span><span class="p">)</span>
        
        <span class="n">pointer</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="n">volumeNum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pointer</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">transNum</span> <span class="o">=</span> <span class="n">pointer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">lineNum</span> <span class="o">=</span> <span class="mi">6</span><span class="o">+</span><span class="mi">16</span><span class="o">*</span><span class="n">volumeNum</span><span class="o">+</span><span class="mi">23</span><span class="o">*</span><span class="n">transNum</span>
        
        <span class="n">newBasin</span> <span class="o">=</span> <span class="n">BasinObject</span><span class="p">(</span><span class="n">KMCRunner</span><span class="p">)</span>
        <span class="n">newBasin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="n">lineNum</span><span class="p">])</span>
        
        <span class="c1"># check end sign and basinNo</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">lineNum</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tmp</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&lt;!Basin&quot;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end sign while reading basin file.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">7</span><span class="p">:])</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Error end basin number while reading basin file.&quot;</span><span class="p">)</span>
            
        <span class="k">del</span> <span class="n">line</span><span class="p">[:</span><span class="n">lineNum</span><span class="p">]</span>
        <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newBasin</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">debugBasin</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
            <span class="nb">print</span> <span class="s2">&quot;*&quot;</span><span class="o">*</span><span class="mi">30</span>
            <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">printout</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">)):</span>
            <span class="n">basinI</span> <span class="o">=</span> <span class="n">KMCRunner</span><span class="o">.</span><span class="n">basinList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">log</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span> <span class="s2">&quot;In basin # </span><span class="si">%d</span><span class="s2">: </span><span class="si">%d</span><span class="s2"> volumes&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">basinI</span><span class="o">.</span><span class="n">defectVolumes</span><span class="p">)),</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span></div>
                
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">LKMC 150623-237-g6ff714a documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Chris Scott, Tomas Lazauskas, Miao Yu.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>